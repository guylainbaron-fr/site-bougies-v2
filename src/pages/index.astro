---
export const prerender = false;

import MainLayout from '../layouts/MainLayout.astro';
import { Image } from 'astro:assets';

// On force l'ignorance si TS fait encore des caprices, 
// mais Vercel le verra car ton 'npm install' a réussi.
// @ts-ignore
import { kv } from '@vercel/kv';

// Imports d'images
import heroHome from "../assets/images/hero-home.webp";
import accueilImg from "../assets/images/accueil-h2-1.webp";
import atelierImg from "../assets/images/accueil-h2-2.webp";
import aproposImg from "../assets/images/accueil-h2-3.webp";

// --- LOGIQUE SIMPLIFIÉE ---
const ua = Astro.request.headers.get("user-agent") || "";
let device = "PC";
if (/android/i.test(ua)) device = "Android";
else if (/iPad|iPhone|iPod/i.test(ua)) device = "iOS";

if (import.meta.env.PROD) {
    try {
        await kv.incr('visites_totales');
        await kv.lpush('journal_visites', JSON.stringify({
            date: new Date().toLocaleString('fr-FR'),
            device: device,
            isQR: Astro.url.searchParams.get('ref') === 'qr'
        }));
        await kv.ltrim('journal_visites', 0, 49);
    } catch (e) {
        console.error("KV Error");
    }
}

// --- 4. DONNÉES STRUCTURÉES ---
const schemaData = JSON.stringify({
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "https://jf-aniuta.vercel.app/#organization",
      "name": "Jean-François & Aniuta",
      "url": "https://jf-aniuta.vercel.app/",
      "logo": {
        "@type": "ImageObject",
        "@id": "https://jf-aniuta.vercel.app/#logo",
        "url": "https://jf-aniuta.vercel.app/images/logo_144.png",
        "contentUrl": "https://jf-aniuta.vercel.app/images/logo_144.png",
        "width": 144,
        "height": 144,
        "caption": "Jean-François & Aniuta"
      }
    },
    {
      "@type": "WebSite",
      "@id": "https://jf-aniuta.vercel.app/#website",
      "url": "https://jf-aniuta.vercel.app/",
      "name": "Jean-François & Aniuta - Créations Artisanales",
      "inLanguage": "fr-FR"
    },
    {
      "@type": "LocalBusiness",
      "@id": "https://jf-aniuta.vercel.app/#localbusiness",
      "name": "Jean-François & Aniuta - Atelier Artisanal (Sculpture & Bougies)",
      "url": "https://jf-aniuta.vercel.app/",
      "telephone": "+33658909835",
      "priceRange": "$$",
      "image": "https://jf-aniuta.vercel.app/images/logo_144.png",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Village de Chasseradès",
        "addressLocality": "Mont Lozère et Goulet",
        "postalCode": "48250",
        "addressRegion": "Occitanie",
        "addressCountry": "FR"
      }
    }
  ]
});
---

<MainLayout 
    title="Jean Francois &amp; ANIUTA Artisans Sculpteurs Lozere 48"
    description="Artisanat du bois et de la bougie de J.F. et Aniuta. Sculptures sur bois local et bougies naturelles a Chasserades."
    holidayMessage="Que l'annee 2026 s'illumine de mille feux... Meilleurs Voeux !"
>
<script type="application/ld+json" slot="head" set:html={schemaData} />

    <section id="hero">
        <Image 
            src={heroHome} 
            alt="Scènes d'atelier de sculptures et bougies" 
            class="hero-background-image" 
            loading="eager"
            fetchpriority="high"
            quality={80}
            width={1435}
            height={708}
            widths={[480, 800, 1435]}
            sizes="(max-width: 768px) 100vw, 1435px"
            decoding="async"
        />
        <div class="container">
            <h1>L'Héritage Lozérien : Maîtres Sculpteurs et Créateurs de Bougies Artisanales.</h1> 
            <p>Chaleur du bois sculpté, réconfort de la flamme parfumée. L'artisanat conçu pour enrichir votre intérieur.</p>
            <a href="/bougies" class="btn large-btn" title="Accéder à notre collection de bougies"> Découvrir l'univers</a>
        </div>
    </section>

    <section id="accueil">
        <div class="container">
            <div class="section-top-image">
                <Image src={accueilImg} alt="Image illustrant l'art du bois et des bougies" class="intro-image-1" width={600} height={669} />
            </div>
            <h2>L'Art du Bois et le Parfum des Sens.</h2>               
            <p>
                Découvrez l'harmonie parfaite entre la chaleur du bois sculpté et les senteurs envoûtantes de nos créations artisanales. Chaque pièce raconte une histoire de passion et de nature.
            </p>
            <a href="/bougies" class="btn">Découvrir les Bougies</a> 
        </div>
    </section>

    <section id="atelier">
        <div class="container">
            <div class="section-top-image">
                <Image src={atelierImg} alt="Vue intérieure de l'atelier de création" class="intro-image-2" width={600} height={800} />
            </div>
            <h2>Notre Atelier : Là où la Magie Opère</h2>
            <p>
                Situé à Chasseradès, au cœur de la Lozère, notre atelier est le lieu de rencontre entre la matière brute (bois locaux) et notre savoir-faire ancestral. Venez découvrir notre processus de création, de la première découpe à la dernière finition.
            </p>
            <a href="/atelier" class="btn">Visiter l'Atelier</a>
        </div>
    </section>

    <section id="apropos">
        <div class="container">
            <div class="section-top-image">
                <Image src={aproposImg} alt="Portrait de l'artisan Jean-François BARON" class="intro-image-3" width={600} height={669} />
            </div>
            <h2>À Propos de l'Artisan et Notre Histoire</h2>
            <p>
                Artisans passionnés, Jean François & Aniuta se consacrent au travail du bois depuis de nombreuses années. Chaque pièce est le fruit d'une démarche respectueuse du matériau et d'une recherche d'esthétisme unique. Nous privilégions les essences locales et les finitions naturelles.
            </p>
            <a href="/apropos" class="btn">En Savoir Plus sur Nous</a> 
        </div>
    </section>

</MainLayout>