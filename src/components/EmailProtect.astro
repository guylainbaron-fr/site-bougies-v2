---
// src/components/EmailProtect.astro
interface Props {
  class?: string;
}

const { class: className = "" } = Astro.props;

const p1 = "bm9yYWJzaW9jbmFyZm5hZWo="; 
const p2 = "dGVuLmV0c29wYWw=";
---

<a href="#" 
   class={`email-placeholder ${className}`}
   data-p1={p1} 
   data-p2={p2}
>
    <noscript><small style="font-size: 0.85em; opacity: 0.7;">Email protégé</small></noscript>
</a>

<script>
    const revealEmails = () => {
        const placeholders = document.querySelectorAll('.email-placeholder');
        
        placeholders.forEach(el => {
            const htmlEl = el as HTMLAnchorElement;
            if (htmlEl.getAttribute('data-filled') === 'true') return;

            const part1 = htmlEl.getAttribute('data-p1') || "";
            const part2 = htmlEl.getAttribute('data-p2') || "";
            
            if (part1 !== "" && part2 !== "") {
                try {
                    const user = atob(part1).split('').reverse().join('');
                    const domain = atob(part2).split('').reverse().join('');
                    const email = `${user}@${domain}`;
                    
                    htmlEl.href = `mailto:${email}`;
                    htmlEl.textContent = email;
                    htmlEl.setAttribute('data-filled', 'true');
                } catch (e) {
                    console.error("Erreur EmailProtect:", e);
                }
            }
        });
    }

    revealEmails();
    document.addEventListener('astro:page-load', revealEmails);
</script>

<style>
    .email-placeholder {
        display: inline-block;
        vertical-align: middle;
        text-decoration: none;
        color: inherit;
    }
</style>